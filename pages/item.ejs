<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Shop: <%= itemData["name"] %> </title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/itemstyle.css" rel="stylesheet" />
    
    </head>

        <!-- Section-->
        <body style="background-color:#b7e4c7";>
            <div class = "toppane"> 
                <%- include('../partials/navbar'); %>
            </div>
            <div class = "leftpane"> 
                <div style="width:50%; float:left; margin-left:30px;"> 
                    <div class="container">
            <style>
            :root {
                --orange: #fd9940;
                --darkorange: #dd7d25;
                --platinum: #e5e5e5;
                --black: #2b2d42;
                --white: #fff;
              }
              
              * {
                box-sizing: border-box;
                padding: 0;
                margin: 0;
              }
              
              body {
                font: 18px "Rubik", sans-serif;
                color: var(--black);
                background: var(--platinum);
                margin: 50px 0;
              }
              
              .container {
                max-width: 1400px;
                padding: 0 15px;
                margin: 0 auto;
              }
              
              h2 {
                font-size: 32px;
                margin-bottom: 1em;
              }
              
              .cards {
                display: grid;
                grid-auto-columns: 50%;
                grid-column-gap: 10px;
                grid-auto-flow: column;
                padding: 15px 0px;
                list-style: none;
                width: 55rem;
              }
              
              .card {
                display: inline-block;
                flex-direction: column;
                padding: 30px;
                background: var(--white);
                border-radius: 12px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 15%);
                transition: all 0.2s; 
              }
              
              .card:hover {
                color: var(--white);
                background: var(--orange);
              }
              
              .card .card-title {
                font-size: 20px;
              }
              
              .card .card-content {
                margin: 20px 0;
                max-width: 70rem ;
              }
              
              
              .card .card-link {
                display: inline-block;
                text-decoration: none;
                color: white;
                background: var(--orange);
                padding: 6px 12px;
                border-radius: 8px;
                transition: background 0.2s;
              }
              
              .card:hover .card-link {
                background: var(--darkorange);
              }
              
              
              @media (min-width: 700px) {
                .cards {
                  grid-auto-columns: calc(20% - 10px);
                  grid-column-gap: 20px;
                }
              }
              
              @media (min-width: 700px) {
                .cards {
                  grid-auto-columns: calc(calc(100% / 3) - 20px);
                  grid-column-gap: 30px;
                }
              }


            </style>
                            <ul class="cards";>
                              <li class="card">
                                <div>
                                  <div class="card-content">
                                    <img class="img-fluid" src="<%= itemData['photoUrl'][0];%>" width="250px" height="200px">
                                  </div>
                                </div>
                              </li>
                              <li class="card">
                                <div>
                                  <div class="card-content">
                                    <img class="img-fluid" src="<%= itemData['photoUrl'][1];%>" width="250px" height="200px">
                                </div>
                         
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-left:50px; margin-right:30px;"> 
                        <div class = "rightpane">                 
                                    <h2 class="card-title">
                                        <%= itemData["name"] %> 
                                    </h2>
                                    <br>
                                            <div class="card-content">
                                                <h5>Price:  â‚± <%= parseFloat(itemData["price"]).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %></h5>
                                                    <br> 
                                                  <p>Description: <%= itemData["description"] %>
                                                </p>
                                                <br>
                                                  <form action="/itempage/<%=id%>" method="POST">
                                                        <label>Enter Procurement Count: </label>
                                                        <input id="Procbox" type="number" name= "qty">
                                                        <input id="Insbtn" type = 'submit' value = "Add"></input>
                                                </form>
                                                <div class="table-responsive-md"></div>
                                                <table class="table table-bordered" border="2" cellspacing="4" cellpadding="3" id ="myTable" >
                                                    <thead>
                                                        <tr>
                                                        <th style="text-align:left">Date/Time</th>
                                                        <th style="text-align:right">Quantity</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% var totalQty = 0; %>
                                                        <% for (var index=0;  index < hist_array.length; index++){ %> 
                                                        <tr>
                                                            <td style="text-align:left"><%= hist_array[index].dateCreated.toDate();%></td>
                                                            <td style="text-align:justify"><%= (hist_array[index].Quantity);%></td>              
                                                        </tr>
                                                    </tbody>  
                                                    <p><% totalQty += (hist_array[index].Quantity);%> </p>
                                                    <% } %> 
                                                </table>
                                                <p id="totalQty">Total Quantity: <%= totalQty%> kilos </p> 
                                        <script type = "module">
                                            function addRow() {
                                                    var table =  document.getElementById("myTable");
                                                    var qty = document.getElementById("AddBox").value*1;
                                                    var totalQty =document.getElementById("totalQty"); 
                                                    var sum = 0;
                                                    var row = table.insertRow(-1);
                                                    var cell1 = row.insertCell(0);
                                                    var cell2 = row.insertCell(1);
                                                    cell2.innerHTML = qty;
                                                    cell1.innerHTML = new Date();
                                                        for(var i = 1; i < table.rows.length; i++)
                                                        {
                                                        sum = sum + parseInt(table.rows[i].cells[1].innerHTML); 
                                                        }
                                                    document.getElementById("totalQty").innerHTML="Total Quantity: " + sum;}
                                                    function myDeleteFunction() {
                                                    document.getElementById("myTable").deleteRow(-1);
                                                    }
                                            // Import the functions you need from the SDKs you need
                                            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
                                           // Import the functions you need from the SDKs you need
                                            // TODO: Add SDKs for Firebase products that you want to use
                                            // https://firebase.google.com/docs/web/setup#available-libraries

                                            // Your web app's Firebase configuration
                                            const firebaseConfig = {
                                              apiKey: "AIzaSyCpe4rXF_u894lZAxoqbGrCgS_ETYhzLWc",
                                              authDomain: "organic-vegetables-f858e.firebaseapp.com",
                                              projectId: "organic-vegetables-f858e",
                                              storageBucket: "organic-vegetables-f858e.appspot.com",
                                              messagingSenderId: "282919038334",
                                              appId: "1:282919038334:web:24ed6c11c83fd6aaa4972f"
                                            };

                                            // Initialize Firebase
                                            const app = initializeApp(firebaseConfig);

                                            import {
                                                getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField
                                            }
                                            from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";

                                            var fs = require("firebase-admin");
                                            const db = fs.firestore();
                                            const messageRef = db.collection('items').doc(id).collection('procurement');


                                            //-- references --//
                                            let ProcBox = document.getElementById("Procbox");
                                            let insBtn = document.getElementById("Insbtn");

                                           
                                            insBtn.addEventListener("click", AddDocument_AutoID);

                                      </script>
                                      

                                </div>
                            </div>
                        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="app.js"></script>               
    </body>
</html>
